
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Advanced Configuration &#8212; Fab 1.1.dev0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="_static/documentation_options.js?v=b25a302a"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'advanced_config';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Features" href="features.html" />
    <link rel="prev" title="How to Write a Build Configuration" href="writing_config.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Fab 1.1.dev0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="install.html">
    Installing Fab
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="environment.html">
    Environment
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="metoffice.html">
    Using Fab at the Met Office
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="config_intro.html">
    Introduction to Configuration
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="writing_config.html">
    How to Write a Build Configuration
  </a>
</li>

            <li class="nav-item dropdown pst-header-nav-item">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class="nav-item  current active">
  <a class="nav-link dropdown-item nav-internal" href="#">
    Advanced Configuration
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link dropdown-item nav-internal" href="features.html">
    Features
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link dropdown-item nav-internal" href="api.html">
    Api Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link dropdown-item nav-internal" href="development.html">
    Developerâ€™s guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link dropdown-item nav-internal" href="glossary.html">
    Glossary
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link dropdown-item nav-internal" href="genindex.html">
    Index
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link dropdown-item nav-internal" href="py-modindex.html">
    Python Module Index
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/metomi/fab" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="install.html">
    Installing Fab
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="environment.html">
    Environment
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="metoffice.html">
    Using Fab at the Met Office
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="config_intro.html">
    Introduction to Configuration
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="writing_config.html">
    How to Write a Build Configuration
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Advanced Configuration
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="features.html">
    Features
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="api.html">
    Api Reference
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="development.html">
    Developerâ€™s guide
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="glossary.html">
    Glossary
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="genindex.html">
    Index
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="py-modindex.html">
    Python Module Index
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/metomi/fab" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Advanced...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="advanced-configuration">
<span id="advanced-config"></span><h1>Advanced Configuration<a class="headerlink" href="#advanced-configuration" title="Link to this heading">#</a></h1>
<p>A lot can be achieved with simple configurations but some of the more esoteric
aspects of software building may require more esoteric Fab features.</p>
<section id="understanding-the-environment">
<span id="env-vars"></span><h2>Understanding the Environment<a class="headerlink" href="#understanding-the-environment" title="Link to this heading">#</a></h2>
<p>Fab uses well-known environment variables to identify tools and configure them.</p>
<div class="pst-scrollable-table-container"><table class="table" id="id3">
<caption><span class="caption-text">Environment variables</span><a class="headerlink" href="#id3" title="Link to this table">#</a></caption>
<tbody>
<tr class="row-odd"><td><p>FPP</p></td>
<td><p>Fortran preprocessor, e.g <code class="docutils literal notranslate"><span class="pre">fpp</span></code> or <code class="docutils literal notranslate"><span class="pre">cpp</span> <span class="pre">-traditional-cpp</span> <span class="pre">-P</span></code>.
Fab imposes the <code class="docutils literal notranslate"><span class="pre">-P</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>FC</p></td>
<td><p>Fortran compiler, e.g <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> or <code class="docutils literal notranslate"><span class="pre">ifort</span> <span class="pre">-c</span></code>.
Fab imposes the <code class="docutils literal notranslate"><span class="pre">-c</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>FFLAGS</p></td>
<td><p>Fortran compiler flags..</p></td>
</tr>
<tr class="row-even"><td><p>CC</p></td>
<td><p>C compiler.</p></td>
</tr>
<tr class="row-odd"><td><p>CFLAGS</p></td>
<td><p>C compiler flags.</p></td>
</tr>
<tr class="row-even"><td><p>LD</p></td>
<td><p>Linker, e.g <code class="docutils literal notranslate"><span class="pre">ld</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>LFLAGS</p></td>
<td><p>Linker flags.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="configuration-reuse">
<h2>Configuration Reuse<a class="headerlink" href="#configuration-reuse" title="Link to this heading">#</a></h2>
<p>If you find you have multiple build configurations with duplicated code, it
could be helpful to factor out the commonality into a shared module. Remember,
your build configuration is just a Python script at the end of the day.</p>
<p>In Fabâ€™s
<a class="reference external" href="https://github.com/metomi/fab/tree/master/run_configs">example configurations</a>,
we have two build scripts to compile GCOM. Much of the configuration for these
two scripts is identical. We extracted the common steps into
<a class="reference external" href="https://github.com/metomi/fab/blob/master/run_configs/gcom/gcom_build_steps.py">gcom_build_steps.py</a>
and used them in
<a class="reference external" href="https://github.com/metomi/fab/blob/master/run_configs/gcom/build_gcom_ar.py">build_gcom_ar.py</a>
and
<a class="reference external" href="https://github.com/metomi/fab/blob/master/run_configs/gcom/build_gcom_so.py">build_gcom_so.py</a>.</p>
</section>
<section id="separate-grab-and-build-scripts">
<h2>Separate grab and build scripts<a class="headerlink" href="#separate-grab-and-build-scripts" title="Link to this heading">#</a></h2>
<p>If you are running many builds from the same source, you may wish to grab your
repo in a separate script and call it less frequently.</p>
<p>In this case your grab script might only contain a single step. You could
import your grab configuration to find out where it put the source.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">my_grab.py</span><a class="headerlink" href="#id4" title="Link to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">my_grab_config</span> <span class="o">=</span> <span class="n">BuildConfig</span><span class="p">(</span><span class="n">project_label</span><span class="o">=</span><span class="s1">&#39;&lt;project_label&gt;&#39;</span><span class="p">)</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">4</span>    <span class="k">with</span> <span class="n">my_grab_config</span><span class="p">:</span>
<span class="linenos">5</span>        <span class="n">fcm_export</span><span class="p">(</span><span class="n">my_grab_config</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s1">&#39;my_repo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">my_build.py</span><a class="headerlink" href="#id5" title="Link to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">my_grab</span> <span class="kn">import</span> <span class="n">my_grab_config</span>
<span class="linenos">2</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">5</span>    <span class="k">with</span> <span class="n">BuildConfig</span><span class="p">(</span><span class="n">project_label</span><span class="o">=</span><span class="s1">&#39;&lt;project_label&gt;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">state</span><span class="p">:</span>
<span class="hll"><span class="linenos">6</span>        <span class="n">grab_folder</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">my_grab_config</span><span class="o">.</span><span class="n">source_root</span><span class="p">),</span>
</span></pre></div>
</div>
</div>
</section>
<section id="housekeeping">
<h2>Housekeeping<a class="headerlink" href="#housekeeping" title="Link to this heading">#</a></h2>
<p>You can add a <a class="reference internal" href="apidoc/fab.steps.cleanup_prebuilds.html#fab.steps.cleanup_prebuilds.cleanup_prebuilds" title="fab.steps.cleanup_prebuilds.cleanup_prebuilds"><code class="xref py py-func docutils literal notranslate"><span class="pre">cleanup_prebuilds()</span></code></a>
step, where you can explicitly control how long to keep prebuild files.
This may be useful, for example, if you often switch between two versions
of your code and want to keep the prebuild speed benefits when building
both.</p>
<p>If you do not add your own cleanup_prebuild step, Fab will
automatically run a default step which will remove old files from the
prebuilds folder. It will remove all prebuild files that are not part of
the current build by default.</p>
</section>
<section id="sharing-prebuilds">
<h2>Sharing Prebuilds<a class="headerlink" href="#sharing-prebuilds" title="Link to this heading">#</a></h2>
<p>You can copy the contents of someone elseâ€™s prebuilds folder into your own.</p>
<p>Fab uses hashes to keep track of the correct prebuilt files, and will find and
use them. Thereâ€™s also a helper step called
<a class="reference internal" href="apidoc/fab.steps.grab.prebuild.html#fab.steps.grab.prebuild.grab_pre_build" title="fab.steps.grab.prebuild.grab_pre_build"><code class="xref py py-func docutils literal notranslate"><span class="pre">grab_pre_build()</span></code></a> you can add to your build
configurations.</p>
</section>
<section id="psykalight-psyclone-overrides">
<h2>PSyKAlight (PSyclone overrides)<a class="headerlink" href="#psykalight-psyclone-overrides" title="Link to this heading">#</a></h2>
<p>If you need to override a PSyclone output file with a handcrafted version
you can use the <code class="docutils literal notranslate"><span class="pre">overrides_folder</span></code> argument to the
<a class="reference internal" href="apidoc/fab.steps.psyclone.html#fab.steps.psyclone.psyclone" title="fab.steps.psyclone.psyclone"><code class="xref py py-func docutils literal notranslate"><span class="pre">psyclone()</span></code></a> step.</p>
<p>This specifies a normal folder containing source files. The step will delete
any files it creates if thereâ€™s a matching filename in the overrides folder.</p>
</section>
<section id="two-stage-compilation">
<h2>Two-Stage Compilation<a class="headerlink" href="#two-stage-compilation" title="Link to this heading">#</a></h2>
<dl class="simple">
<dt>The <a class="reference internal" href="apidoc/fab.steps.compile_fortran.html#fab.steps.compile_fortran.compile_fortran" title="fab.steps.compile_fortran.compile_fortran"><code class="xref py py-func docutils literal notranslate"><span class="pre">compile_fortran()</span></code></a> step compiles files in</dt><dd><p>passes, with each pass identifying all the files which can be compiled next,
and compiling them in parallel.</p>
</dd>
</dl>
<p>Some projects have bottlenecks in their compile order, where lots of files are
stuck behind a single file which is slow to compile. Inspired by
<a class="reference external" href="https://www.osti.gov/biblio/1393322">Busby</a>, Fab can perform two-stage
compilation where all the modules are built first in <em>fast passes</em> using the
<cite>-fsyntax-only</cite> flag, and then all the slower object compilation can follow in
a single pass.</p>
<p>The <em>potential</em> benefit is that the bottleneck is shortened, but there is a
tradeoff with having to run through all the files twice. Some compilers might
not have this capability.</p>
<p>Two-stage compilation is configured with the <cite>two_stage_flag</cite> argument to the
Fortran compiler.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">compile_fortran</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">two_stage_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="managed-arguments">
<h2>Managed arguments<a class="headerlink" href="#managed-arguments" title="Link to this heading">#</a></h2>
<p>As noted above, Fab manages a few command line arguments for some of the tools
it uses.</p>
<section id="fortran-preprocessors">
<h3>Fortran Preprocessors<a class="headerlink" href="#fortran-preprocessors" title="Link to this heading">#</a></h3>
<p>Fab knows about some preprocessors which are used with Fortran, currently <em>fpp</em>
and <em>cpp</em>. It will ensure the <code class="docutils literal notranslate"><span class="pre">-P</span></code> flag is present to disable line numbering
directives in the output, which is currently required for fparser to parse the
output.</p>
</section>
<section id="fortran-compilers">
<h3>Fortran Compilers<a class="headerlink" href="#fortran-compilers" title="Link to this heading">#</a></h3>
<p>Fab knows about some Fortran compilers (currently <em>gfortran</em> or <em>ifort</em>).
It will make sure the <cite>-c</cite> flag is present to compile but not link.</p>
<p>If the compiler flag which sets the module folder is present, i.e. <code class="docutils literal notranslate"><span class="pre">-J</span></code> for
gfortran or <code class="docutils literal notranslate"><span class="pre">-module</span></code> for ifort, Fab will <strong>remove</strong> the flag, with a
notification, as it needs to use this flag to control the output location.</p>
</section>
</section>
<section id="tool-arguments">
<span id="advanced-flags"></span><h2>Tool arguments<a class="headerlink" href="#tool-arguments" title="Link to this heading">#</a></h2>
<p>Sometimes it is necessary to pass additional arguments when we call a software
tool.</p>
<section id="linker-flags">
<h3>Linker flags<a class="headerlink" href="#linker-flags" title="Link to this heading">#</a></h3>
<p>Probably the most common instance of the need to pass additional arguments is
to specify 3rd party libraries at the link stage.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">link_exe</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-lm&#39;</span><span class="p">,</span> <span class="s1">&#39;-lnetcdf&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="path-specific-flags">
<h3>Path-specific flags<a class="headerlink" href="#path-specific-flags" title="Link to this heading">#</a></h3>
<p>For preprocessing and compilation, we sometimes need to specify flags
<em>per-file</em>. These steps accept both common flags and <em>path specific</em> flags.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="o">...</span>
<span class="linenos">2</span><span class="n">compile_fortran</span><span class="p">(</span>
<span class="linenos">3</span>    <span class="n">common_flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-O2&#39;</span><span class="p">],</span>
<span class="linenos">4</span>    <span class="n">path_flags</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">5</span>        <span class="n">AddFlags</span><span class="p">(</span><span class="s1">&#39;$output/um/*&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;-I&#39;</span> <span class="o">+</span> <span class="s1">&#39;/gcom&#39;</span><span class="p">])</span>
<span class="linenos">6</span>    <span class="p">],</span>
<span class="linenos">7</span><span class="p">)</span>
</pre></div>
</div>
<p>This will add <code class="docutils literal notranslate"><span class="pre">-O2</span></code> to every invocation of the tool, but only add the
<code class="docutils literal notranslate"><span class="pre">*/gcom*</span></code> include path when processing files in the
<code class="docutils literal notranslate"><span class="pre">*&lt;project</span> <span class="pre">workspace&gt;/build_output/um*</span></code> folder.</p>
<p>Path matching is done using Pythonâ€™s <a class="reference external" href="https://docs.python.org/3.10/library/fnmatch.html#fnmatch.fnmatch">fnmatch</a>.
The <code class="docutils literal notranslate"><span class="pre">$output</span></code> is a template, see <a class="reference internal" href="apidoc/fab.build_config.html#fab.build_config.AddFlags" title="fab.build_config.AddFlags"><code class="xref py py-class docutils literal notranslate"><span class="pre">AddFlags</span></code></a>.</p>
<p>We can currently only <em>add</em> flags for a path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This can require some understanding of where and when files are placed in
the <em>build_output</em> folder: It will generally match the structure youâ€™ve
created in <code class="docutils literal notranslate"><span class="pre">*&lt;project</span> <span class="pre">workspace&gt;/source*</span></code>, with your grab steps.</p>
<p>Early steps like preprocessors generally read files from <code class="docutils literal notranslate"><span class="pre">*source*</span></code> and
write to <code class="docutils literal notranslate"><span class="pre">*build_output*</span></code>.</p>
<p>Later steps like compilers generally read files which are already in
<code class="docutils literal notranslate"><span class="pre">*build_output*</span></code>.</p>
<p>For more information on where files end up see <a class="reference internal" href="#directory-structure"><span class="std std-ref">Folder Structure</span></a>.</p>
</div>
</section>
</section>
<section id="folder-structure">
<span id="directory-structure"></span><h2>Folder Structure<a class="headerlink" href="#folder-structure" title="Link to this heading">#</a></h2>
<p>It may be useful to understand how Fab uses the <a class="reference internal" href="glossary.html#term-Project-Workspace"><span class="xref std std-term">Project Workspace</span></a> and
in particular where it creates files within it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;your $FAB_WORKSPACE&gt;
   &lt;project workspace&gt;
      source/
      build_output/
         *.f90 (preprocessed Fortran files)
         *.mod (compiled module files)
         _prebuild/
            *.an (analysis results)
            *.o (compiled object files)
            *.mod (mod files)
      metrics/
      my_program.exe
      log.txt
</pre></div>
</div>
<p>The <em>project workspace</em> folder takes its name from the project label passed in to the build configuration.</p>
<p>The <em>source</em> folder is where grab steps place their files.</p>
<p>The <em>build_output</em> folder is where steps put their processed files.
For example, a preprocessor reads <code class="docutils literal notranslate"><span class="pre">.F90</span></code> from <em>source</em> and writes <code class="docutils literal notranslate"><span class="pre">.f90</span></code> to <em>build_output</em>.</p>
<p>The <em>_prebuild</em> folder contains reusable output. Files in this folder include a hash value in their filenames.</p>
<p>The <em>metrics</em> folder contains some useful stats and graphs. See <a class="reference internal" href="features.html#metrics"><span class="std std-ref">Metrics</span></a>.</p>
</section>
<section id="c-pragma-injector">
<span id="id1"></span><h2>C Pragma Injector<a class="headerlink" href="#c-pragma-injector" title="Link to this heading">#</a></h2>
<p>The C pragma injector creates new C files with <code class="docutils literal notranslate"><span class="pre">.prag</span></code> file extensions, in the
source folder. The C preprocessor looks for the output of this step by default.
If not found, it will fall back to looking for <code class="docutils literal notranslate"><span class="pre">.c</span></code> files in the source
listing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="o">...</span>
<span class="linenos">2</span><span class="n">c_pragma_injector</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">preprocess_c</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="linenos">4</span><span class="o">...</span>
</pre></div>
</div>
</section>
<section id="custom-steps">
<span id="id2"></span><h2>Custom Steps<a class="headerlink" href="#custom-steps" title="Link to this heading">#</a></h2>
<p>If you need a custom build step, you can create a function with the &#64;step
decorator.</p>
<p>Some example custom steps are included in the Fab testing configurations. For
example a simple example was created for building JULES.</p>
<p>The <a class="reference internal" href="apidoc/fab.steps.root_inc_files.html#fab.steps.root_inc_files.root_inc_files" title="fab.steps.root_inc_files.root_inc_files"><code class="xref py py-func docutils literal notranslate"><span class="pre">root_inc_files()</span></code></a> step copies all <code class="docutils literal notranslate"><span class="pre">.inc</span></code>
files in the source tree into the root of the source tree, to make subsequent
preprocessing flags easier to configure.</p>
<p>That is a simple example that doesnâ€™t need to interact with the
<a class="reference internal" href="glossary.html#term-Artefact-Store"><span class="xref std std-term">Artefact Store</span></a>. Sometimes inserting a custom step means inserting a new
<a class="reference internal" href="glossary.html#term-Artefact-Collection"><span class="xref std std-term">Artefact Collection</span></a> into the flow of data between steps.</p>
<p>We can tell a subsequent step to read our new artefacts, instead of using itâ€™s
default <a class="reference internal" href="glossary.html#term-Artefacts-Getter"><span class="xref std std-term">Artefacts Getter</span></a>. We do this using the <code class="docutils literal notranslate"><span class="pre">source</span></code> argument,
which most Fab steps accept. (See <a class="reference internal" href="#overriding-default-collections"><span class="std std-ref">Collection names</span></a>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nd">@step</span>
<span class="linenos">2</span><span class="k">def</span> <span class="nf">custom_step</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="linenos">3</span>    <span class="n">state</span><span class="o">.</span><span class="n">artefact_store</span><span class="p">[</span><span class="s1">&#39;custom_artefacts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_something</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">artefact_store</span><span class="p">[</span><span class="s1">&#39;step 1 artefacts&#39;</span><span class="p">])</span>
<span class="linenos">4</span>
<span class="linenos">5</span>
<span class="linenos">6</span><span class="k">with</span> <span class="n">BuildConfig</span><span class="p">(</span><span class="n">project_label</span><span class="o">=</span><span class="s1">&#39;&lt;project label&gt;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">state</span><span class="p">:</span>
<span class="linenos">7</span>    <span class="n">fab_step1</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="linenos">8</span>    <span class="n">custom_step</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="linenos">9</span>    <span class="n">fab_step2</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">CollectionGetter</span><span class="p">(</span><span class="s1">&#39;custom_artefacts&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Steps have access to multiprocessing methods through the
<a class="reference internal" href="apidoc/fab.steps.html#fab.steps.run_mp" title="fab.steps.run_mp"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_mp()</span></code></a> helper function. This processes artefacts in parallel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nd">@step</span>
<span class="linenos">2</span><span class="k">def</span> <span class="nf">custom_step</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="linenos">3</span>    <span class="n">input_files</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">artefact_store</span><span class="p">[</span><span class="s1">&#39;custom_artefacts&#39;</span><span class="p">]</span>
<span class="linenos">4</span>    <span class="n">results</span> <span class="o">=</span> <span class="n">run_mp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">input_files</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">do_something</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="collection-names">
<span id="overriding-default-collections"></span><h2>Collection names<a class="headerlink" href="#collection-names" title="Link to this heading">#</a></h2>
<p>Most steps allow the collections they read from and write to to be changed.</p>
<p>Letâ€™s imagine we need to upgrade a build script, adding a custom step to
prepare our Fortran files for preprocessing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">find_source_files</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># this was already here</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1"># instead of this</span>
<span class="linenos"> 4</span><span class="c1"># preprocess_fortran(state)</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c1"># we now do this</span>
<span class="linenos"> 7</span><span class="n">my_new_step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">output_collection</span><span class="o">=</span><span class="s1">&#39;my_new_collection&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="n">preprocess_fortran</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">CollectionGetter</span><span class="p">(</span><span class="s1">&#39;my_new_collection&#39;</span><span class="p">))</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="n">analyse</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># this was already here</span>
</pre></div>
</div>
</section>
<section id="parser-workarounds">
<h2>Parser Workarounds<a class="headerlink" href="#parser-workarounds" title="Link to this heading">#</a></h2>
<p>Sometimes the parser used by Fab to understand source code can be unable to
parse valid source files due to bugs or shortcomings. In order to still be able
to build such code a number of possible work-arounds are presented.</p>
<section id="unrecognised-dependencies">
<span id="unrecognised-deps-workaround"></span><h3>Unrecognised Dependencies<a class="headerlink" href="#unrecognised-dependencies" title="Link to this heading">#</a></h3>
<p>If a language parser is not able to recognise a dependency within a file,
then Fab wonâ€™t know the dependency needs to be compiled.</p>
<p>For example, some versions of fparser donâ€™t recognise a call on a one-line if
statement.</p>
<p>We can manually add the dependency using the <cite>unreferenced_deps</cite> argument to
<a class="reference internal" href="apidoc/fab.steps.analyse.html#fab.steps.analyse.analyse" title="fab.steps.analyse.analyse"><code class="xref py py-func docutils literal notranslate"><span class="pre">analyse()</span></code></a>.</p>
<p>Pass in the name of the called function. Fab will find the file containing this
symbol and add it, <em>and all its dependencies</em>, to every <a class="reference internal" href="glossary.html#term-Build-Tree"><span class="xref std std-term">Build Tree</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="o">...</span>
<span class="linenos">2</span><span class="n">analyse</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">root_symbol</span><span class="o">=</span><span class="s1">&#39;my_prog&#39;</span><span class="p">,</span> <span class="n">unreferenced_deps</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;my_func&#39;</span><span class="p">])</span>
<span class="linenos">3</span><span class="o">...</span>
</pre></div>
</div>
</section>
<section id="unparsable-files">
<h3>Unparsable Files<a class="headerlink" href="#unparsable-files" title="Link to this heading">#</a></h3>
<p>If a language parser is not able to process a file at all, then Fab wonâ€™t know
about any of its symbols and dependencies. This can sometimes happen to <em>valid
code</em> which compilers <em>are</em> able to process, for example if the language parser
is still maturing and canâ€™t yet handle an uncommon syntax.</p>
<p>In this case we can manually give Fab the analysis results using the
<cite>special_measure_analysis_results</cite> argument to
<a class="reference internal" href="apidoc/fab.steps.analyse.html#fab.steps.analyse.analyse" title="fab.steps.analyse.analyse"><code class="xref py py-func docutils literal notranslate"><span class="pre">analyse()</span></code></a>.</p>
<p>Pass in a list of <a class="reference internal" href="apidoc/fab.parse.fortran.html#fab.parse.fortran.FortranParserWorkaround" title="fab.parse.fortran.FortranParserWorkaround"><code class="xref py py-class docutils literal notranslate"><span class="pre">FortranParserWorkaround</span></code></a> objects,
one for every file that canâ€™t be parsed. Each object contains the symbol
definitions and dependencies found in one source file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="o">...</span>
<span class="linenos"> 2</span><span class="n">analyse</span><span class="p">(</span>
<span class="linenos"> 3</span>    <span class="n">config</span><span class="p">,</span>
<span class="linenos"> 4</span>    <span class="n">root_symbol</span><span class="o">=</span><span class="s1">&#39;my_prog&#39;</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="n">special_measure_analysis_results</span><span class="o">=</span><span class="p">[</span>
<span class="linenos"> 6</span>        <span class="n">FortranParserWorkaround</span><span class="p">(</span>
<span class="linenos"> 7</span>            <span class="n">fpath</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">build_output</span> <span class="o">/</span> <span class="s2">&quot;path/to/file.f90&quot;</span><span class="p">),</span>
<span class="linenos"> 8</span>            <span class="n">module_defs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;my_mod&#39;</span><span class="p">},</span> <span class="n">symbol_defs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;my_func&#39;</span><span class="p">},</span>
<span class="linenos"> 9</span>            <span class="n">module_deps</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;other_mod&#39;</span><span class="p">},</span> <span class="n">symbol_deps</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;other_func&#39;</span><span class="p">}),</span>
<span class="linenos">10</span>    <span class="p">])</span>
<span class="linenos">11</span><span class="o">...</span>
</pre></div>
</div>
<p>In the above snippet we tell Fab that <code class="docutils literal notranslate"><span class="pre">file.f90</span></code> defines a module called
<code class="docutils literal notranslate"><span class="pre">my_mod</span></code> and a function called <code class="docutils literal notranslate"><span class="pre">my_func</span></code>, and depends on a module called
<code class="docutils literal notranslate"><span class="pre">other_mod</span></code> and a function called <code class="docutils literal notranslate"><span class="pre">other_func</span></code>.</p>
<section id="custom-step">
<h4>Custom Step<a class="headerlink" href="#custom-step" title="Link to this heading">#</a></h4>
<p>An alternative approach for some problems is to write a custom step to modify
the source so that the language parser can process it. Hereâ€™s a simple example,
based on a
<a class="reference external" href="https://github.com/metomi/fab/blob/216e00253ede22bfbcc2ee9b2e490d8c40421e5d/run_configs/um/build_um.py#L42-L65">real workaround</a>
where the parser gets confused by a variable called <cite>NameListFile</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nd">@step</span>
<span class="linenos"> 2</span><span class="k">def</span> <span class="nf">my_custom_code_fixes</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="linenos"> 3</span>    <span class="n">fpath</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">source_root</span> <span class="o">/</span> <span class="s1">&#39;path/to/file.F90&#39;</span>
<span class="linenos"> 4</span>    <span class="ow">in</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos"> 5</span>    <span class="n">out</span> <span class="o">=</span> <span class="ow">in</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NameListFile&quot;</span><span class="p">,</span> <span class="s2">&quot;MyRenamedVariable&quot;</span><span class="p">)</span>
<span class="linenos"> 6</span>    <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">with</span> <span class="n">BuildConfig</span><span class="p">(</span><span class="n">project_label</span><span class="o">=</span><span class="s1">&#39;&lt;project_label&gt;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">state</span><span class="p">:</span>
<span class="linenos"> 9</span>    <span class="c1"># grab steps first</span>
<span class="linenos">10</span>    <span class="n">my_custom_code_fixes</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="linenos">11</span>    <span class="c1"># find_source_files, preprocess, etc, afterwards</span>
</pre></div>
</div>
<p>A more detailed treatment of <a class="reference internal" href="#custom-steps"><span class="std std-ref">Custom Steps</span></a> is given elsewhere.</p>
</section>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="writing_config.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How to Write a Build Configuration</p>
      </div>
    </a>
    <a class="right-next"
       href="features.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Features</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-environment">Understanding the Environment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-reuse">Configuration Reuse</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#separate-grab-and-build-scripts">Separate grab and build scripts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#housekeeping">Housekeeping</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sharing-prebuilds">Sharing Prebuilds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psykalight-psyclone-overrides">PSyKAlight (PSyclone overrides)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-stage-compilation">Two-Stage Compilation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managed-arguments">Managed arguments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fortran-preprocessors">Fortran Preprocessors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fortran-compilers">Fortran Compilers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tool-arguments">Tool arguments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linker-flags">Linker flags</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#path-specific-flags">Path-specific flags</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#folder-structure">Folder Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#c-pragma-injector">C Pragma Injector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-steps">Custom Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#collection-names">Collection names</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parser-workarounds">Parser Workarounds</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unrecognised-dependencies">Unrecognised Dependencies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unparsable-files">Unparsable Files</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-step">Custom Step</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/advanced_config.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">


<p class="copyright">
    
    Â© Crown Copyright 2024 Met Office. All rights reserved..
    
</p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>